# Git Hooks Documentation

This document describes the Git hooks provided by AI Coding Assistants Setup, including the innovative AI-only development enforcement feature.

## Overview

The project uses [Husky](https://typicode.github.io/husky/) to manage Git hooks that enforce code quality, commit standards, and AI-assisted development practices. These hooks run automatically at different stages of the Git workflow to maintain consistency and quality.

## Available Hooks

### 1. Pre-commit Hook (`.husky/pre-commit`)

**Purpose**: Runs quality checks before allowing a commit to proceed.

**Checks performed**:

- Secret detection with Gitleaks (if installed)
- Linting (`npm run lint`)
- Code formatting (`npm run format:check`)
- Type checking (`npm run typecheck`)
- Unit tests (`npm run test:unit`)

**Features**:

- Intelligently detects the package manager (npm, yarn, or bun)
- Only runs checks if the corresponding scripts exist in package.json
- Provides clear feedback on which checks are running
- Shows helpful error messages when checks fail

#### Secret Detection with Gitleaks

The pre-commit hook includes automated secret scanning using Gitleaks:

- **Automatic detection**: Scans staged files for secrets before commit
- **Graceful fallback**: If Gitleaks isn't installed, shows a warning but continues
- **Configuration**: Uses `.gitleaks.toml` for custom rules and `.gitleaksignore` for false positives
- **Installation instructions**: Provides platform-specific installation commands

To install Gitleaks:

- macOS: `brew install gitleaks`
- Windows: `scoop install gitleaks` or `choco install gitleaks`
- Linux: See [Gitleaks installation guide](https://github.com/gitleaks/gitleaks#installing)

**To skip** (use sparingly):

```bash
git commit --no-verify -m "emergency fix"
```

### 2. Commit Message Hook (`.husky/commit-msg`)

**Purpose**: Validates commit messages and enforces AI-generated commits.

**Features**:

#### AI-Only Commit Enforcement

This hook **blocks all non-AI-generated commits**. All commits must include AI signatures such as:

- `Co-Authored-By: Claude <noreply@anthropic.com>`
- `Generated with Claude Code`
- `Generated with [Claude Code]`
- `ü§ñ Generated with`
- GitHub Copilot signatures
- Other AI service signatures

#### Jira Key Integration

- Automatically extracts Jira keys from branch names
- Appends the key to commit messages if not already present
- Supports custom project key patterns via `JIRA_PROJECT_KEY` environment variable

#### Conventional Commits

- Validates commit messages against conventional commit standards
- Ensures proper format: `type(scope): subject`
- Provides examples of valid commit types

**Error Messages**:

```
‚ùå Non-AI-generated commit detected!

This project requires all commits to be generated by an AI assistant.
Please use one of the following AI tools to generate your commit:
  - Claude Code (adds 'Co-Authored-By: Claude <noreply@anthropic.com>')
  - GitHub Copilot
  - Other AI assistants that add appropriate signatures
```

### 3. Pre-push Hook (`.husky/pre-push`)

**Purpose**: Ensures pull requests are AI-generated before allowing pushes.

**Features**:

- Checks if a PR exists for the current branch
- Verifies PR was created by an AI assistant
- Looks for AI signatures in PR body
- Identifies bot authors (dependabot, renovate, etc.)
- Gracefully handles missing GitHub CLI or non-GitHub repos

**Requirements**:

- GitHub CLI (`gh`) for PR verification
- Authentication with GitHub

**AI PR Signatures**:

- `ü§ñ Generated with [Claude Code](https://claude.ai/code)`
- `Generated with Claude Code`
- `Created by Claude`
- `Created by GitHub Copilot`
- Bot account authors

**Skips checks for**:

- Main/master branches
- Repositories without GitHub CLI
- Non-GitHub repositories

## Configuration

### Environment Variables

#### Jira Integration

```bash
# Custom Jira project key pattern (default: [A-Z]{2,10})
export JIRA_PROJECT_KEY="PROJ|TEAM|DEPT"
```

### Package Manager Detection

The hooks automatically detect your package manager based on lock files:

- `package-lock.json` ‚Üí npm
- `yarn.lock` ‚Üí yarn
- `bun.lockb` ‚Üí bun

## AI Development Workflow

### Using Claude Code

1. **Creating Commits**:

   ```bash
   # Use Claude's git-commit command
   /git-commit
   # This automatically adds: Co-Authored-By: Claude <noreply@anthropic.com>
   ```

2. **Creating Pull Requests**:
   ```bash
   # Claude will include the required signature
   # PR body will contain: ü§ñ Generated with [Claude Code](https://claude.ai/code)
   ```

### Using GitHub Copilot

1. **Commits**: Use Copilot CLI or ensure commit messages include Copilot signatures
2. **PRs**: Use `gh copilot pr create` or similar commands

## Customization

### Modifying AI Enforcement

To customize which patterns are accepted, edit the hooks:

1. **Commit patterns** in `.husky/commit-msg`:

   ```bash
   AI_PATTERNS=(
     "Your-Custom-Pattern"
     "Your-AI-Tool-Signature"
   )
   ```

2. **PR patterns** in `.husky/pre-push`:
   ```bash
   AI_PR_PATTERNS=(
     "Your-Custom-PR-Pattern"
   )
   ```

### Disabling AI Enforcement

To allow human-generated commits/PRs:

```bash
# Remove the hooks
rm .husky/commit-msg
rm .husky/pre-push

# Or modify them to remove the AI checking logic
```

## Troubleshooting

### Common Issues

1. **"GitHub CLI (gh) not found"**

   - Install GitHub CLI: `brew install gh` (macOS) or see [cli.github.com](https://cli.github.com)
   - The hook will still allow pushes but won't check PRs

2. **"Not a GitHub repository"**

   - The pre-push hook only works with GitHub repos
   - It will skip checks for other Git providers

3. **Commit blocked despite using AI**

   - Ensure your AI tool includes the proper signatures
   - Check that the signature format matches exactly
   - For Claude: use `/git-commit` command

4. **PR check fails**
   - Ensure the PR was created with AI signatures in the body
   - Check that you're authenticated with GitHub CLI: `gh auth status`

### Debug Mode

To see detailed output from hooks:

```bash
# Enable debug mode
export HUSKY_DEBUG=1

# Run your git command
git commit -m "test"
```

## Best Practices

1. **Always use AI assistants** for commits and PRs to maintain consistency
2. **Don't bypass hooks** unless absolutely necessary
3. **Keep AI signatures** in your commits for audit trails
4. **Configure Jira keys** if your team uses Jira for issue tracking
5. **Install GitHub CLI** to enable PR verification

## Integration with CI/CD

These hooks complement the CI/CD workflows:

- Local hooks catch issues before pushing
- CI/CD provides additional validation
- Both ensure code quality and standards

## Benefits of AI-Only Development

1. **Consistency**: All code follows AI-assisted best practices
2. **Quality**: Leverages AI for better code structure
3. **Documentation**: AI naturally documents changes better
4. **Security**: AI tools can catch security issues early
5. **Compliance**: Ensures team adheres to development standards

---

For more information:

- [Husky Documentation](https://typicode.github.io/husky/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code)
- [GitHub CLI Documentation](https://cli.github.com/manual/)
